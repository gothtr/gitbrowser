<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="design-tokens.css" />
<link rel="stylesheet" href="components.css" />
<style>
.toolbar-row { display: flex; gap: var(--space-sm); margin-bottom: var(--space-xl); animation: itemSlideIn var(--duration-normal) var(--ease-out) 0.05s both; }
.ext-list { display: flex; flex-direction: column; gap: var(--space-sm); }
.ext-card {
  display: flex; align-items: center; gap: var(--space-lg); padding: var(--space-lg);
  background: var(--glass-bg-solid); backdrop-filter: var(--glass-blur); -webkit-backdrop-filter: var(--glass-blur);
  border: 1px solid var(--glass-border); border-radius: var(--radius-md);
  transition: all var(--duration-fast) var(--ease-out);
  animation: itemSlideIn var(--duration-normal) var(--ease-out) both;
}
.ext-card:hover { border-color: var(--glass-border-hover); }
.ext-icon {
  width: 44px; height: 44px; border-radius: var(--radius-sm); background: var(--bg-subtle);
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.ext-info { flex: 1; min-width: 0; }
.ext-name { font-size: var(--text-md); font-weight: 500; }
.ext-meta { font-size: var(--text-sm); color: var(--fg-muted); margin-top: 2px; display: flex; align-items: center; gap: var(--space-sm); }
.ext-actions { display: flex; gap: var(--space-sm); align-items: center; }
.empty-state svg { width: 48px; height: 48px; }
</style>
</head>
<body>
<div class="page-container">
  <div class="page-header" style="animation:itemSlideIn var(--duration-normal) var(--ease-out)">
    <svg width="28" height="28" viewBox="0 0 16 16" fill="var(--accent-fg)"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"/></svg>
    <div class="page-title" id="title">Extensions</div>
  </div>
  <div class="page-desc" id="desc">Manage your browser extensions</div>
  <div class="toolbar-row">
    <button class="btn btn-primary btn-pill" id="installBtn">
      <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M7.75 2a.75.75 0 0 1 .75.75V7h4.25a.75.75 0 0 1 0 1.5H8.5v4.25a.75.75 0 0 1-1.5 0V8.5H2.75a.75.75 0 0 1 0-1.5H7V2.75A.75.75 0 0 1 7.75 2Z"/></svg>
      Install Extension
    </button>
  </div>
  <div style="font-size:var(--text-sm);color:var(--fg-muted);margin-bottom:var(--space-lg);padding:var(--space-md);background:var(--glass-bg-hover);border-radius:var(--radius-sm);border:1px solid var(--glass-border)">
    <svg width="12" height="12" viewBox="0 0 16 16" fill="var(--accent-fg)" style="vertical-align:-1px;margin-right:4px"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>
    Supports unpacked Chrome extensions (Manifest V2/V3). Download and unpack a Chrome extension, then select its folder.
  </div>
  <div class="ext-list" id="list"></div>
</div>
<script>
const gb = window.gitbrowser, listEl = document.getElementById('list');

async function load() {
  let exts;
  try { exts = await gb.extensionList(); } catch { exts = []; }
  if (!Array.isArray(exts) || !exts.length) {
    listEl.innerHTML = `<div class="empty-state">
      <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"/></svg>
      <div>No extensions installed</div></div>`;
    return;
  }
  listEl.innerHTML = '';
  exts.forEach((ext, i) => {
    const div = document.createElement('div');
    div.className = 'ext-card';
    div.style.animationDelay = i * 40 + 'ms';
    const isChrome = ext.type === 'chrome';
    const badge = isChrome ? '<span class="badge badge-accent" style="font-size:10px">Chrome</span>' : '';
    div.innerHTML = `
      <div class="ext-icon"><svg width="22" height="22" viewBox="0 0 16 16" fill="var(--accent-fg)"><path d="M5.5 4.25a2.25 2.25 0 0 1 4.5 0 .75.75 0 0 0 .75.75h2.5c.14 0 .25.11.25.25v2.5a.75.75 0 0 0 .75.75 2.25 2.25 0 0 1 0 4.5.75.75 0 0 0-.75.75v2.5a.25.25 0 0 1-.25.25h-2.5a.75.75 0 0 1-.75-.75 2.25 2.25 0 0 0-4.5 0 .75.75 0 0 1-.75.75H2.25a.25.25 0 0 1-.25-.25v-2.5a.75.75 0 0 0-.75-.75 2.25 2.25 0 0 1 0-4.5.75.75 0 0 0 .75-.75v-2.5c0-.14.11-.25.25-.25h2.5a.75.75 0 0 0 .75-.75z"/></svg></div>
      <div class="ext-info">
        <div class="ext-name">${esc(ext.name)}</div>
        <div class="ext-meta">${ext.version ? 'v' + esc(ext.version) : ''} ${badge} <span class="badge ${ext.enabled !== false ? 'badge-success' : ''}" style="${ext.enabled !== false ? '' : 'background:var(--bg-subtle);color:var(--fg-subtle)'}">${ext.enabled !== false ? 'Enabled' : 'Disabled'}</span></div>
      </div>
      <div class="ext-actions">
        <button class="btn btn-ghost btn-danger" data-remove="${ext.id}" style="font-size:var(--text-sm)">Remove</button>
      </div>`;
    div.querySelector('[data-remove]').onclick = async () => { try { await gb.extensionUninstall(ext.id); load(); } catch {} };
    listEl.appendChild(div);
  });
}

document.getElementById('installBtn').onclick = async () => {
  try {
    const result = await gb.extensionSelectPath();
    if (result && !result.canceled && result.path) {
      await gb.extensionInstall(result.path);
      load();
    }
  } catch {}
};

function esc(s) { const d = document.createElement('div'); d.textContent = s || ''; return d.innerHTML; }

function applyTheme(t) { document.documentElement.classList.add('theme-transition'); document.documentElement.classList.toggle('light', t === 'Light'); setTimeout(() => document.documentElement.classList.remove('theme-transition'), 300); }
if (gb) { gb.onThemeChanged((d) => applyTheme(d.theme)); gb.getSettings().then(s => { if(s&&s.appearance){let t=s.appearance.theme;if(t==='System')t=window.matchMedia('(prefers-color-scheme:light)').matches?'Light':'Dark';applyTheme(t)} }).catch(()=>{}); }
load();
if (gb && gb.getLocaleData) { gb.getLocaleData().then(({data:t}) => { if(t&&t.extensions){document.getElementById('title').textContent=t.extensions.title||'Extensions';document.getElementById('desc').textContent=t.extensions.desc||'Manage your browser extensions'} }).catch(()=>{}); }
</script>
</body>
</html>