# GitBrowser — План исправлений и доработок

## Статус: В работе

---

## 1. Загрузки (Downloads) — КРИТИЧНО

### Проблемы
- Файлы не сохраняются автоматически в папку "Загрузки" Windows — вместо этого Electron показывает диалог или не сохраняет вообще
- Нет анимации загрузки (прогресс-бар есть, но без визуального фидбека — скорость, ETA, пульсация)
- Нельзя скачать картинку с интернета — в контекстном меню нет пункта "Сохранить изображение"
- Нет кнопки "Открыть файл" / "Открыть папку" после завершения загрузки
- Загрузки не персистятся в Rust backend — только в памяти Electron

### Исправления
- [x] Автосохранение в `app.getPath('downloads')` с дедупликацией имён
- [x] Расчёт скорости загрузки и ETA
- [x] Контекстное меню: "Сохранить изображение", "Копировать URL изображения", "Открыть изображение в новой вкладке"
- [x] Анимация пульсации прогресс-бара в downloads.html
- [x] Отображение скорости и ETA в UI загрузок
- [x] Кнопки "Открыть файл" / "Показать в папке" после завершения
- [x] Уведомление (toast) при завершении загрузки

---

## 2. История браузера — КРИТИЧНО

### Проблемы
- `visit_time` хранится как UNIX timestamp (секунды), но UI пытается парсить через `new Date(t)` — JS ожидает миллисекунды, поэтому даты отображаются как 1970-й год
- История записывается в `did-navigate`, но title на этот момент ещё может быть пустым — записывается "New Tab" вместо реального заголовка
- Нет группировки по дням (Сегодня / Вчера / Ранее)

### Исправления
- [x] Передавать `visit_time` как ISO строку или миллисекунды из RPC
- [x] Записывать историю после `page-title-updated` (когда title уже известен), а не в `did-navigate`
- [x] Добавить группировку по дням в history.html
- [x] Добавить favicon в записи истории

---

## 3. UI/UX — Стиль и удобство

### Проблемы
- Кнопки в тулбаре маленькие (28px), неудобно нажимать
- Нет hover-анимаций на внутренних страницах
- Главная страница (newtab) скучная — просто лого + поиск + сетка ссылок
- Нет персонализации (фон, виджеты)
- Дизайн функциональный, но не "стильный"

### Исправления
- [x] Увеличить кнопки тулбара до 34px, добавить плавные hover-эффекты
- [x] Переработать newtab: приветствие по времени суток, часы, погода-виджет (опционально), красивая типографика
- [x] Добавить анимации появления элементов на всех внутренних страницах (stagger fade-in)
- [x] Улучшить карточки quick-links: показывать favicon сайта вместо буквы
- [ ] Добавить возможность менять фон newtab (solid colors, без градиентов)
- [x] Сделать более крупные и читаемые элементы на страницах bookmarks/history/downloads
- [x] Чистый, минималистичный стиль — без фиолетовых/градиентных акцентов

---

## 4. Локализация — ВЫСОКИЙ ПРИОРИТЕТ

### Проблемы
- Контекстное меню не загружает локаль при старте — `cachedLocale` = null до первого вызова `loadContextMenuLocale()`
- Hardcoded строки в downloads.html ("Completed", "Failed", "No downloads yet")
- Hardcoded строки в history.html ("No history", "History cleared")
- Заголовки внутренних вкладок ("Settings", "History" и т.д.) не локализованы в `getInternalTitle()`
- Нет ключей локализации для новых фич (сохранение изображений, менеджер паролей)

### Исправления
- [x] Загружать локаль при старте приложения (до создания окна)
- [x] Локализовать все hardcoded строки в HTML-страницах
- [x] Локализовать `getInternalTitle()` через кэшированную локаль
- [x] Добавить недостающие ключи в en.json и ru.json (context_menu.save_image, context_menu.copy_image_url, context_menu.open_image_new_tab, passwords.*, extensions.*)
- [x] Локализовать toast-сообщения

---

## 5. GitHub интеграция — ВЫСОКИЙ ПРИОРИТЕТ

### Проблемы
- Интеграция минимальная: логин + список репозиториев + 4 ссылки
- Нет уведомлений (badge в тулбаре)
- Нет просмотра Issues, Pull Requests, Activity Feed
- Нет синхронизации закладок/настроек через Gists
- Токен хранится в localStorage (небезопасно)
- По сути это "аккаунт браузера", но функционал не соответствует

### Исправления
- [ ] Добавить вкладки в profile-view: Repos / Notifications / Issues / PRs / Activity
- [ ] Показывать непрочитанные уведомления (badge на кнопке GitHub в тулбаре)
- [ ] Добавить Activity Feed (последние события пользователя)
- [ ] Добавить просмотр Issues и PRs с фильтрацией
- [ ] Добавить синхронизацию закладок через GitHub Gists (encrypt → upload)
- [ ] Перенести токен из localStorage в зашифрованное хранилище Rust backend
- [ ] Добавить информацию профиля: bio, followers, following, public repos count
- [ ] Добавить быстрые действия: создать repo, создать gist, открыть GitHub Copilot

---

## 6. Менеджер паролей — НОВАЯ ФИЧА

### Проблемы
- Backend (`PasswordManager`) полностью реализован: unlock/lock, save/get/update/delete credentials, generate password, export/import
- Нет UI вообще — нет страницы, нет IPC handlers, нет preload API
- Нет автозаполнения на веб-страницах
- Нет RPC handlers в rpc_server.rs

### Исправления
- [ ] Создать `electron/ui/passwords.html` — UI менеджера паролей
- [ ] Добавить IPC handlers в main.js: password-unlock, password-lock, password-list, password-save, password-delete, password-generate
- [ ] Добавить preload API: `passwordUnlock()`, `passwordLock()`, `passwordList()`, `passwordSave()`, `passwordDelete()`, `passwordGenerate()`
- [ ] Добавить RPC handlers в rpc_server.rs
- [ ] Добавить кнопку "Пароли" в тулбар или в настройки
- [ ] Добавить автозаполнение: при фокусе на поле пароля показывать popup с сохранёнными credentials
- [ ] Добавить предложение сохранить пароль после логина на сайте

---

## 7. Безопасность

### Проблемы
- API ключи AI хранятся в localStorage (открытый текст)
- GitHub токен в localStorage
- Encryption key для GitHub/AI в Rust захардкожен (`gitbrowser-github-key-v1`, `gitbrowser-ai-key-v1`)
- Нет CSP (Content Security Policy) для внутренних страниц
- Нет валидации URL в RPC handlers (bookmark.add не проверяет формат URL)
- Session data не зашифрована

### Исправления
- [ ] Перенести API ключи из localStorage в зашифрованное хранилище через Rust backend
- [ ] Использовать master password от PasswordManager для шифрования всех секретов
- [ ] Добавить CSP headers для внутренних страниц
- [x] Валидация URL в RPC handlers
- [ ] Шифровать session.json

---

## 8. Расширения (Extensions) — НОВАЯ ФИЧА

### Проблемы
- Backend (`ExtensionFramework`) реализован: install/uninstall/enable/disable
- Нет UI для управления расширениями
- Нет API для разработчиков расширений
- Нет документации

### Исправления
- [ ] Создать `electron/ui/extensions.html` — UI менеджера расширений
- [ ] Добавить IPC handlers и preload API
- [ ] Добавить RPC handlers в rpc_server.rs
- [ ] Определить Extension API: manifest.json формат, доступные API (tabs, bookmarks, storage, notifications)
- [ ] Создать документацию для разработчиков расширений (EXTENSIONS.md)
- [ ] Добавить кнопку расширений в тулбар
- [ ] Поддержка content scripts (инъекция JS/CSS в веб-страницы)

---

## 9. Стабильность

### Проблемы
- Event listeners не очищаются при закрытии вкладок → утечки памяти
- `downloadItems` Map никогда не чистится для завершённых загрузок (уже пофикшено в done handler, но Map `downloads` растёт бесконечно)
- `closedTabsStack` ограничен 20, но `downloads` Map — нет
- Нет обработки ошибок при падении Rust RPC процесса
- Нет reconnect логики для RustBridge

### Исправления
- [x] Добавить очистку downloads Map (удалять записи старше 24ч)
- [x] Добавить reconnect в RustBridge при падении процесса
- [x] Добавить graceful error handling при потере связи с backend
- [x] Добавить health check (ping) для RPC connection
- [x] Очищать event listeners при закрытии вкладок

---

## 10. Мелкие баги и недоработки

- [x] `getInternalTitle()` возвращает hardcoded английские названия — нужна локализация
- [ ] Приватное окно не имеет отдельного tab management — это просто одна вкладка
- [ ] Reader mode кнопка скрыта по умолчанию, но не появляется надёжно на всех страницах
- [x] Bookmark добавляется с пустым title (передаётся `title: ''` из тулбара)
- [x] Zoom indicator не показывает текущий уровень при переключении вкладок
- [x] Find bar не закрывается при переключении вкладок
- [x] Нет Ctrl+Tab для переключения между вкладками
- [ ] Нет middle-click для открытия ссылки в новой вкладке
- [x] Toast сообщения не локализованы
- [x] Нет подтверждения при очистке истории

---

## Приоритеты выполнения

| # | Задача | Приоритет | Сложность |
|---|--------|-----------|-----------|
| 1 | Загрузки (автосохранение, анимация, картинки) | Критично | Средняя |
| 2 | История (правильные даты, title, группировка) | Критично | Низкая |
| 3 | Локализация (все hardcoded строки) | Высокий | Средняя |
| 4 | UI/UX (стиль, кнопки, анимации, newtab) | Высокий | Высокая |
| 5 | GitHub интеграция (уведомления, issues, sync) | Высокий | Высокая |
| 6 | Менеджер паролей (UI + IPC + автозаполнение) | Средний | Высокая |
| 7 | Безопасность (ключи, CSP, валидация) | Средний | Средняя |
| 8 | Расширения (UI + API + документация) | Средний | Очень высокая |
| 9 | Стабильность (утечки, reconnect, errors) | Средний | Средняя |
| 10 | Мелкие баги | Низкий | Низкая |
