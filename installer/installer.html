<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{
  width:420px;height:420px;overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans',Helvetica,Arial,sans-serif;
  background:#0a0e14;color:#e2e8f0;
  user-select:none;-webkit-user-select:none;
}

body{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  position:relative;
}

/* Subtle top glow */
body::before{
  content:'';position:absolute;top:-120px;left:50%;transform:translateX(-50%);
  width:300px;height:240px;
  background:radial-gradient(ellipse,rgba(59,130,246,0.07) 0%,transparent 70%);
  pointer-events:none;
}

/* ── Title bar (drag area) ── */
.titlebar{
  position:absolute;top:0;left:0;right:0;height:32px;
  -webkit-app-region:drag;
  display:flex;align-items:center;justify-content:flex-end;
  padding:0 6px;
}
.close{
  -webkit-app-region:no-drag;
  width:28px;height:28px;border:none;background:none;
  color:#4a5168;cursor:pointer;border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  transition:all 150ms cubic-bezier(0.16,1,0.3,1);
}
.close:hover{background:rgba(255,255,255,0.07);color:#e2e8f0}
.close:active{transform:scale(0.92)}

/* ── Logo ── */
.logo{
  width:56px;height:56px;border-radius:14px;
  background:linear-gradient(135deg,#12161e 0%,#1a1f2b 100%);
  border:1px solid rgba(255,255,255,0.06);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 8px 32px rgba(0,0,0,0.4),inset 0 1px 0 rgba(255,255,255,0.04);
  animation:logoIn 0.5s cubic-bezier(0.16,1,0.3,1) both;
  margin-bottom:16px;
}
.logo img{width:36px;height:36px;border-radius:6px}
@keyframes logoIn{from{opacity:0;transform:scale(0.85) translateY(6px)}to{opacity:1;transform:none}}

/* ── Text ── */
.name{
  font-size:20px;font-weight:700;color:#e2e8f0;letter-spacing:-0.3px;
  animation:fadeIn 0.4s 0.05s cubic-bezier(0.16,1,0.3,1) both;
}
.ver{
  font-size:11px;color:#4a5168;margin-top:3px;font-weight:500;
  animation:fadeIn 0.4s 0.1s cubic-bezier(0.16,1,0.3,1) both;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* ── Status ── */
.status{
  margin-top:28px;font-size:12px;color:#4a5168;height:16px;
  transition:color 0.2s;
  animation:fadeIn 0.4s 0.15s cubic-bezier(0.16,1,0.3,1) both;
}

/* ── Progress ── */
.track{
  margin-top:12px;width:240px;height:3px;
  background:rgba(255,255,255,0.04);border-radius:2px;
  overflow:hidden;opacity:0;transition:opacity 0.3s;
}
.track.on{opacity:1}
.bar{
  height:100%;width:0%;border-radius:2px;
  background:linear-gradient(90deg,#3b82f6,#60a5fa);
  box-shadow:0 0 10px rgba(59,130,246,0.3);
  transition:width 0.4s cubic-bezier(0.16,1,0.3,1);
}
.bar.pulse{
  width:30%;
  animation:pulse 1.4s cubic-bezier(0.4,0,0.6,1) infinite;
}
@keyframes pulse{0%{transform:translateX(-100%)}100%{transform:translateX(433%)}}

/* ── Button ── */
.btn{
  margin-top:24px;width:160px;height:38px;
  border:none;border-radius:10px;
  background:rgba(59,130,246,0.12);
  color:#60a5fa;
  font-family:inherit;font-size:13px;font-weight:600;
  cursor:pointer;letter-spacing:0.1px;
  transition:all 0.2s cubic-bezier(0.16,1,0.3,1);
  border:1px solid rgba(59,130,246,0.15);
  animation:fadeIn 0.4s 0.2s cubic-bezier(0.16,1,0.3,1) both;
  -webkit-app-region:no-drag;
}
.btn:hover{
  background:rgba(59,130,246,0.18);
  border-color:rgba(59,130,246,0.25);
  box-shadow:0 0 20px rgba(59,130,246,0.1);
}
.btn:active{transform:scale(0.97)}
.btn:disabled{opacity:0.35;cursor:default;transform:none;box-shadow:none}
.btn.done{
  background:rgba(52,211,153,0.12);
  border-color:rgba(52,211,153,0.15);
  color:#34d399;
}
.btn.done:hover{
  background:rgba(52,211,153,0.18);
  border-color:rgba(52,211,153,0.25);
  box-shadow:0 0 20px rgba(52,211,153,0.1);
}

/* ── Path ── */
.path{
  position:absolute;bottom:16px;
  font-size:10px;color:rgba(255,255,255,0.1);
  max-width:380px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
}
</style>
</head>
<body>

<div class="titlebar">
  <button class="close" id="x">
    <svg width="10" height="10" viewBox="0 0 10 10" stroke="currentColor" stroke-width="1.3" fill="none">
      <line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/>
    </svg>
  </button>
</div>

<div class="logo"><img id="icon" src="" onerror="this.parentElement.innerHTML='<span style=color:#60a5fa;font-size:20px;font-weight:700>G</span>'" /></div>
<div class="name">GitBrowser</div>
<div class="ver" id="ver">v0.1.0</div>
<div class="status" id="st">Checking for updates…</div>
<div class="track" id="track"><div class="bar" id="bar"></div></div>
<button class="btn" id="btn" disabled>Install</button>
<div class="path" id="path"></div>

<script>
const api = window.installer;
const $ = id => document.getElementById(id);

let downloadUrl = null;

$('x').onclick = () => api.close();

async function init() {
  // Load icon from correct path (works in both dev and packaged mode)
  try {
    const iconPath = await api.getIconPath();
    $('icon').src = iconPath;
  } catch { /* fallback handled by onerror */ }

  const info = await api.getInfo();
  $('ver').textContent = 'v' + info.version;
  $('path').textContent = info.installDir;

  // Check updates
  $('track').classList.add('on');
  $('bar').classList.add('pulse');

  const upd = await api.checkUpdate();

  $('bar').classList.remove('pulse');
  $('bar').style.width = '0%';
  $('track').classList.remove('on');

  if (upd.latest && upd.latest !== info.version && upd.download) {
    $('st').textContent = 'v' + upd.latest + ' available';
    $('st').style.color = '#60a5fa';
    $('ver').textContent = 'v' + info.version + '  →  v' + upd.latest;
    downloadUrl = upd.download;
  } else {
    $('st').textContent = 'Ready to install';
    $('st').style.color = '#4a5168';
  }
  $('btn').disabled = false;
}

$('btn').onclick = async () => {
  $('btn').disabled = true;
  $('track').classList.add('on');

  // Phase 1: install
  $('st').textContent = downloadUrl ? 'Downloading…' : 'Installing…';
  $('st').style.color = '#7c8494';
  anim(0, 50, 2000);

  const res = await api.install({ downloadUrl });
  if (!res.ok) {
    $('st').textContent = res.error || 'Failed';
    $('st').style.color = '#f87171';
    $('bar').style.background = 'linear-gradient(90deg,#f87171,#dc2626)';
    $('bar').style.width = '100%';
    $('btn').textContent = 'Retry';
    $('btn').disabled = false;
    return;
  }

  // Phase 2: shortcuts
  $('st').textContent = 'Creating shortcuts…';
  anim(50, 85, 600);
  await api.createShortcuts();

  // Phase 3: done
  anim(85, 100, 300);
  await new Promise(r => setTimeout(r, 400));

  $('st').textContent = 'Done';
  $('st').style.color = '#34d399';
  $('bar').style.width = '100%';
  $('bar').style.background = 'linear-gradient(90deg,#059669,#34d399)';

  $('btn').textContent = 'Launch';
  $('btn').classList.add('done');
  $('btn').disabled = false;
  $('btn').onclick = () => api.launchApp();
};

function anim(from, to, ms) {
  const t0 = performance.now();
  (function tick(now) {
    const p = Math.min((now - t0) / ms, 1);
    const e = 1 - Math.pow(1 - p, 3);
    $('bar').style.width = (from + (to - from) * e) + '%';
    if (p < 1) requestAnimationFrame(tick);
  })(t0);
}

init();
</script>
</body>
</html>
