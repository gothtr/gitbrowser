<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{
  width:480px;height:480px;overflow:hidden;
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Noto Sans',Helvetica,Arial,sans-serif;
  background:#0a0e14;color:#e2e8f0;
  user-select:none;-webkit-user-select:none;
  -webkit-font-smoothing:antialiased;
}
body{display:flex;flex-direction:column;position:relative;border-radius:16px;overflow:hidden}

.bg-glow{position:absolute;inset:0;pointer-events:none;overflow:hidden}
.bg-glow::before{
  content:'';position:absolute;top:-50%;left:-30%;width:160%;height:160%;
  background:radial-gradient(ellipse at 30% 30%,rgba(59,130,246,0.07) 0%,transparent 60%),
             radial-gradient(ellipse at 70% 70%,rgba(59,130,246,0.04) 0%,transparent 50%);
  animation:glowDrift 14s ease-in-out infinite alternate;
}
@keyframes glowDrift{0%{transform:translate(0,0) scale(1)}100%{transform:translate(15px,-10px) scale(1.04)}}

.titlebar{
  position:relative;z-index:10;height:32px;flex-shrink:0;
  -webkit-app-region:drag;
  display:flex;align-items:center;justify-content:flex-end;padding:0 6px;
}
.tb-btn{
  -webkit-app-region:no-drag;
  width:28px;height:28px;border:none;background:none;
  color:#4a5168;cursor:pointer;border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  transition:all 150ms cubic-bezier(0.16,1,0.3,1);
}
.tb-btn:hover{background:rgba(255,255,255,0.06);color:#7c8494}
.tb-btn.close-btn:hover{background:rgba(220,38,38,0.12);color:#f87171}

.content{
  flex:1;display:flex;flex-direction:column;align-items:center;
  justify-content:center;position:relative;z-index:1;
  padding:0 36px 24px;gap:0;
}

.logo-wrap{animation:logoEnter 0.6s cubic-bezier(0.16,1,0.3,1) both;margin-bottom:6px}
.logo-wrap img{height:64px;width:auto;filter:drop-shadow(0 4px 20px rgba(59,130,246,0.1))}
@keyframes logoEnter{from{opacity:0;transform:scale(0.85) translateY(10px)}to{opacity:1;transform:none}}

.version{
  display:inline-flex;align-items:center;gap:6px;
  padding:3px 10px;border-radius:9999px;
  background:rgba(18,22,30,0.88);
  border:1px solid rgba(255,255,255,0.07);
  font-size:11px;color:#7c8494;font-weight:500;
  animation:fadeUp 0.5s 0.1s cubic-bezier(0.16,1,0.3,1) both;
  margin-bottom:20px;
  box-shadow:inset 0 1px 0 rgba(255,255,255,0.06);
}
.version .dot{width:5px;height:5px;border-radius:50%;background:#3b82f6}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

.steps{
  display:flex;align-items:center;gap:0;margin-bottom:18px;
  animation:fadeUp 0.5s 0.15s cubic-bezier(0.16,1,0.3,1) both;
}
.step{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:500;color:#4a5168;transition:color 0.4s}
.step.active{color:#7c8494}
.step.done{color:#34d399}
.step-dot{
  width:22px;height:22px;border-radius:50%;
  border:1.5px solid rgba(255,255,255,0.08);
  display:flex;align-items:center;justify-content:center;
  font-size:10px;font-weight:700;color:#4a5168;
  transition:all 0.4s cubic-bezier(0.16,1,0.3,1);
}
.step.active .step-dot{border-color:rgba(59,130,246,0.35);color:#60a5fa;box-shadow:0 0 10px rgba(59,130,246,0.15)}
.step.done .step-dot{border-color:rgba(52,211,153,0.35);color:#34d399;background:rgba(52,211,153,0.06)}
.step-line{width:28px;height:1px;background:rgba(255,255,255,0.05);margin:0 4px;position:relative;overflow:hidden}
.step-line::after{
  content:'';position:absolute;inset:0;
  background:linear-gradient(90deg,#3b82f6,#34d399);
  transform:scaleX(0);transform-origin:left;
  transition:transform 0.6s cubic-bezier(0.16,1,0.3,1);
}
.step-line.filled::after{transform:scaleX(1)}

.status-area{text-align:center;margin-bottom:14px;min-height:32px;animation:fadeUp 0.5s 0.2s cubic-bezier(0.16,1,0.3,1) both}
.status-text{font-size:13px;color:#7c8494;transition:color 0.3s}
.status-sub{font-size:11px;color:#4a5168;margin-top:3px;transition:color 0.3s}

.progress-wrap{width:100%;max-width:280px;margin-bottom:18px;animation:fadeUp 0.5s 0.25s cubic-bezier(0.16,1,0.3,1) both}
.progress-track{
  width:100%;height:3px;background:rgba(255,255,255,0.04);border-radius:3px;overflow:hidden;opacity:0;transition:opacity 0.3s;
}
.progress-track.on{opacity:1}
.progress-bar{
  height:100%;width:0%;border-radius:3px;
  background:linear-gradient(90deg,#3b82f6,#60a5fa);
  background-size:200% 100%;
  animation:shimmer 2s linear infinite;
  box-shadow:0 0 8px rgba(59,130,246,0.2);
  transition:width 0.5s cubic-bezier(0.16,1,0.3,1);
}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.progress-bar.pulse{width:30%;animation:barPulse 1.6s cubic-bezier(0.4,0,0.6,1) infinite,shimmer 2s linear infinite}
@keyframes barPulse{0%{transform:translateX(-100%)}100%{transform:translateX(433%)}}
.progress-bar.success{background:linear-gradient(90deg,#059669,#34d399);box-shadow:0 0 8px rgba(52,211,153,0.2)}
.progress-bar.error{background:linear-gradient(90deg,#dc2626,#f87171);box-shadow:0 0 8px rgba(220,38,38,0.2)}
.progress-pct{text-align:right;font-size:10px;color:#4a5168;margin-top:4px;height:12px;transition:color 0.3s}

.action-btn{
  width:180px;height:40px;border:none;border-radius:12px;
  font-family:inherit;font-size:13px;font-weight:600;
  cursor:pointer;letter-spacing:0.2px;
  position:relative;overflow:hidden;
  transition:all 250ms cubic-bezier(0.16,1,0.3,1);
  animation:fadeUp 0.5s 0.3s cubic-bezier(0.16,1,0.3,1) both;
  -webkit-app-region:no-drag;
  background:rgba(59,130,246,0.12);
  border:1px solid rgba(59,130,246,0.2);
  color:#60a5fa;
}
.action-btn::before{content:'';position:absolute;inset:0;background:rgba(59,130,246,0.06);opacity:0;transition:opacity 250ms}
.action-btn:hover::before{opacity:1}
.action-btn:hover{
  border-color:rgba(59,130,246,0.35);
  box-shadow:0 4px 20px rgba(59,130,246,0.12),0 0 0 1px rgba(59,130,246,0.08);
  transform:translateY(-1px);
}
.action-btn:active{transform:translateY(0) scale(0.98)}
.action-btn:disabled{opacity:0.3;cursor:default;transform:none;box-shadow:none}
.action-btn:disabled::before{display:none}
.action-btn.success{background:rgba(52,211,153,0.12);border-color:rgba(52,211,153,0.2);color:#34d399}
.action-btn.success:hover{border-color:rgba(52,211,153,0.35);box-shadow:0 4px 20px rgba(52,211,153,0.12)}

.install-path{
  position:absolute;bottom:10px;left:0;right:0;text-align:center;
  font-size:9px;color:rgba(255,255,255,0.05);padding:0 16px;
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
}

.check-icon{display:inline-block;vertical-align:middle;margin-right:2px}
@keyframes checkDraw{from{stroke-dashoffset:16}to{stroke-dashoffset:0}}

.error-detail{
  margin-top:6px;padding:6px 12px;
  background:rgba(220,38,38,0.06);border:1px solid rgba(220,38,38,0.12);
  border-radius:8px;font-size:11px;color:#f87171;
  max-width:280px;word-break:break-word;text-align:center;
}

</style>
</head>
<body>
<div class="bg-glow"></div>
<div class="titlebar">
  <button class="tb-btn close-btn" id="x">
    <svg width="10" height="10" viewBox="0 0 10 10" stroke="currentColor" stroke-width="1.3" fill="none">
      <line x1="1.5" y1="1.5" x2="8.5" y2="8.5"/><line x1="8.5" y1="1.5" x2="1.5" y2="8.5"/>
    </svg>
  </button>
</div>
<div class="content">
  <div class="logo-wrap"><img id="logo" src="" alt="GitBrowser" /></div>
  <div class="version"><span class="dot"></span><span id="ver">v0.3.0</span></div>
  <div class="steps">
    <div class="step active" id="s1"><div class="step-dot">1</div><span id="s1-label">Check</span></div>
    <div class="step-line" id="line1"></div>
    <div class="step" id="s2"><div class="step-dot">2</div><span id="s2-label">Install</span></div>
    <div class="step-line" id="line2"></div>
    <div class="step" id="s3"><div class="step-dot">3</div><span id="s3-label">Done</span></div>
  </div>
  <div class="status-area">
    <div class="status-text" id="st">Checking for updates…</div>
    <div class="status-sub" id="sub"></div>
  </div>
  <div class="progress-wrap">
    <div class="progress-track" id="track"><div class="progress-bar" id="bar"></div></div>
    <div class="progress-pct" id="pct"></div>
  </div>
  <button class="action-btn" id="btn" disabled>Install</button>
</div>
<div class="install-path" id="pathEl"></div>

<script>
const api = window.installer;
const $ = id => document.getElementById(id);

let downloadUrl = null;
let latestVer = null;

const lang = (navigator.language || '').startsWith('ru') ? 'ru' : 'en';
const L = {
  en: {
    s1:'Check',s2:'Install',s3:'Done',
    checking:'Checking for updates\u2026',
    newVersion:'New version available',
    readyToInstall:'Ready to install',
    latestVersion:'Latest version',
    install:'Install',
    downloading:'Downloading\u2026',
    installing:'Installing\u2026',
    shortcuts:'Creating shortcuts\u2026',
    configuring:'Configuring\u2026',
    errorInstall:'Installation failed',
    retry:'Retry',
    done:'Installation complete',
    ready:'GitBrowser is ready',
    launch:'Launch',
  },
  ru: {
    s1:'Проверка',s2:'Установка',s3:'Готово',
    checking:'Проверка обновлений\u2026',
    newVersion:'Доступна новая версия',
    readyToInstall:'Готов к установке',
    latestVersion:'Последняя версия',
    install:'Установить',
    downloading:'Загрузка\u2026',
    installing:'Установка\u2026',
    shortcuts:'Создание ярлыков\u2026',
    configuring:'Настройка\u2026',
    errorInstall:'Ошибка установки',
    retry:'Повторить',
    done:'Установка завершена',
    ready:'GitBrowser готов к работе',
    launch:'Запустить',
  },
}[lang];

$('s1-label').textContent = L.s1;
$('s2-label').textContent = L.s2;
$('s3-label').textContent = L.s3;
$('st').textContent = L.checking;
$('btn').textContent = L.install;
$('x').onclick = () => api.close();

function setStep(n) {
  for (let i = 1; i <= 3; i++) {
    const el = $('s' + i);
    el.classList.remove('active', 'done');
    if (i < n) el.classList.add('done');
    else if (i === n) el.classList.add('active');
  }
  if (n > 1) $('line1').classList.add('filled');
  if (n > 2) $('line2').classList.add('filled');
}

function setStepDone(n) {
  const dot = $('s' + n).querySelector('.step-dot');
  dot.innerHTML = '<svg class="check-icon" width="11" height="11" viewBox="0 0 12 12"><polyline points="2.5,6.5 5,9 9.5,3.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="stroke-dasharray:16;stroke-dashoffset:16;animation:checkDraw 0.4s 0.1s ease forwards"/></svg>';
}

async function init() {
  try { $('logo').src = await api.getIconPath(); } catch {}
  const info = await api.getInfo();
  $('ver').textContent = 'v' + info.version;
  $('pathEl').textContent = info.installDir;

  setStep(1);
  $('track').classList.add('on');
  $('bar').classList.add('pulse');

  const upd = await api.checkUpdate();
  $('bar').classList.remove('pulse');
  $('bar').style.width = '0%';
  $('track').classList.remove('on');
  setStepDone(1);

  if (upd.latest && upd.latest !== info.version && upd.download) {
    latestVer = upd.latest;
    downloadUrl = upd.download;
    $('st').textContent = L.newVersion;
    $('st').style.color = '#60a5fa';
    $('sub').textContent = 'v' + info.version + '  \u2192  v' + upd.latest;
    $('sub').style.color = '#7c8494';
    $('ver').textContent = 'v' + info.version + ' \u2192 v' + upd.latest;
  } else {
    $('st').textContent = L.readyToInstall;
    $('st').style.color = '#7c8494';
    $('sub').textContent = L.latestVersion;
    $('sub').style.color = '#4a5168';
  }
  setStep(2);
  $('btn').disabled = false;
}

$('btn').onclick = async () => {
  $('btn').disabled = true;
  $('track').classList.add('on');
  $('pct').style.color = '#4a5168';
  const prevErr = document.querySelector('.error-detail');
  if (prevErr) prevErr.remove();

  $('st').textContent = downloadUrl ? L.downloading : L.installing;
  $('st').style.color = '#7c8494';
  $('sub').textContent = '';
  anim(0, 45, 2500);

  const res = await api.install({ downloadUrl });
  if (!res.ok) {
    $('st').textContent = L.errorInstall;
    $('st').style.color = '#f87171';
    $('bar').classList.add('error');
    $('bar').style.width = '100%';
    $('pct').textContent = '';
    if (res.error) {
      const errEl = document.createElement('div');
      errEl.className = 'error-detail';
      errEl.textContent = res.error;
      document.querySelector('.status-area').appendChild(errEl);
    }
    $('btn').textContent = L.retry;
    $('btn').disabled = false;
    return;
  }

  anim(45, 70, 600);
  $('st').textContent = L.shortcuts;
  await api.createShortcuts();

  anim(70, 90, 400);
  $('st').textContent = L.configuring;
  await new Promise(r => setTimeout(r, 300));

  anim(90, 100, 300);
  await new Promise(r => setTimeout(r, 500));

  setStepDone(2);
  setStep(3);
  setStepDone(3);

  $('bar').classList.add('success');
  $('bar').style.width = '100%';
  $('pct').textContent = '100%';
  $('pct').style.color = '#34d399';

  $('st').textContent = L.done;
  $('st').style.color = '#34d399';
  $('sub').textContent = L.ready;
  $('sub').style.color = '#059669';

  $('btn').textContent = L.launch;
  $('btn').classList.add('success');
  $('btn').disabled = false;
  $('btn').onclick = () => api.launchApp();
};

function anim(from, to, ms) {
  const t0 = performance.now();
  (function tick(now) {
    const p = Math.min((now - t0) / ms, 1);
    const e = 1 - Math.pow(1 - p, 3);
    const v = from + (to - from) * e;
    $('bar').style.width = v + '%';
    $('pct').textContent = Math.round(v) + '%';
    if (p < 1) requestAnimationFrame(tick);
  })(t0);
}

init();
</script>
</body>
</html>
